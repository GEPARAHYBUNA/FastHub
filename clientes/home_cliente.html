<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FastHub - Cliente</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {margin: 0; padding: 0; box-sizing: border-box;}
        body {font-family: 'Kanit', sans-serif; color: #1f2937; background: linear-gradient(135deg, #fff 0%, #fdf2f8 100%); min-height: 100vh; display: flex; flex-direction: column;}
        h1, h2, h3, h4, h5, h6 {font-family: 'Bebas Neue', sans-serif; letter-spacing: 0.02em;}
        .container {display: flex; flex-direction: column; min-height: 100vh;}
        
        /* Nav */
        .navbar {background-color: rgba(255,255,255,0.9); backdrop-filter: blur(10px); position: fixed; top: 0; left: 0; right: 0; width: 100%; z-index: 50; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); padding: 1rem 1.5rem;}
        .nav-container {max-width: 1280px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center;}
        .logo {font-weight: bold; font-size: 1.8rem; color: #db2777; letter-spacing: -0.5px;}
        .nav-links {display: flex; margin-left: auto; align-items: center; gap: 1rem;}
        .menu-toggle {display: none; background: none; border: none; color: #db2777; font-size: 1.5rem; cursor: pointer;}
        .nav-link {background: none; border: none; color: #1f2937; cursor: pointer; font-size: 1rem; font-weight: 500; transition: all 0.2s ease; padding: 0.5rem 0.75rem; border-radius: 0.375rem; position: relative; text-decoration: none;}
        .nav-link:hover {color: #db2777; background-color: rgba(219,39,119,0.05);}
        .nav-link::after {content: ''; position: absolute; left: 0.75rem; right: 0.75rem; bottom: 0.25rem; height: 2px; background-color: #db2777; transform: scaleX(0); transition: transform 0.3s ease;}
        .nav-link:hover::after {transform: scaleX(1);}
        
        /* Main */
        .content {flex: 1; padding-top: 6rem; padding-bottom: 2rem; width: 100%; max-width: 1280px; margin: 0 auto; padding-left: 1.5rem; padding-right: 1.5rem;}
        .page {display: none;}
        .page.active {display: block; animation: fadeIn 0.5s ease-out forwards;}
        .header {margin-bottom: 2rem; text-align: center;}
        .title {font-size: 2.5rem; color: #111827; margin-bottom: 0.75rem; position: relative; display: inline-block; padding-bottom: 0.5rem;}
        .title::after {content: ''; position: absolute; bottom: 0; left: 10%; right: 10%; height: 3px; background: linear-gradient(to right, #db2777, #f472b6); border-radius: 1.5px;}
        .subtitle {color: #6b7280; font-size: 1.125rem; max-width: 600px; margin: 0 auto;}
        
        /* Cards */
        .grid {display: grid; grid-template-columns: repeat(1, 1fr); gap: 1.5rem;}
        .card {background-color: white; border-radius: 1rem; overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); transition: all 0.3s ease; border: 1px solid rgba(219,39,119,0.1); display: flex; flex-direction: column; animation: fadeIn 0.6s ease-out forwards; opacity: 0; transform: translateY(10px);}
        .card:hover {transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);}
        
        /* Serviço Cards e Elemtnos */
        .service-category {padding: 0.5rem 1rem; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: white;}
        .category-eletrico {background: linear-gradient(90deg, #db2777, #ec4899);}
        .category-hidraulico {background: linear-gradient(90deg, #0ea5e9, #38bdf8);}
        .category-ar-condicionado {background: linear-gradient(90deg, #10b981, #34d399);}
        .category-limpeza {background: linear-gradient(90deg, #8b5cf6, #a78bfa);}
        .category-pintura {background: linear-gradient(90deg, #f59e0b, #fbbf24);}
        .card-content {padding: 1.5rem; flex: 1; display: flex; flex-direction: column;}
        .card-title {font-size: 1.375rem; font-weight: 600; color: #111827; margin-bottom: 0.75rem; line-height: 1.2;}
        .card-description {color: #4b5563; font-size: 0.9375rem; margin-bottom: 1.25rem; line-height: 1.5; flex: 1;}
        .card-meta {display: flex; justify-content: space-between; padding-top: 1rem; margin-top: 0.5rem; font-size: 0.875rem; color: #6b7280;}
        .urgency-high {color: #ef4444;}
        .urgency-medium {color: #f59e0b;}
        .urgency-low {color: #10b981;}
        
        /* Proporção Cards */
        .proposal-card {border-left: 4px solid #10b981; padding: 1rem; margin-bottom: 1rem;}
        .proposal-provider {font-weight: 500; display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;}
        .provider-icon {width: 2rem; height: 2rem; background-color: #db2777; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600;}
        .proposal-price {font-size: 1.25rem; font-weight: 600; color: #db2777; margin-bottom: 0.5rem;}
        .proposal-message {color: #4b5563; font-size: 0.9375rem; margin-bottom: 1rem; line-height: 1.5;}
        .proposal-actions {display: flex; gap: 0.75rem;}
        
        /* Ação do Botão */
        .action {padding: 0.75rem 1.5rem 1.5rem; text-align: center;}
        .btn {padding: 0.75rem 1.25rem; border-radius: 0.5rem; border: none; background-color: #db2777; color: white; font-weight: 500; cursor: pointer; transition: all 0.2s ease; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; box-shadow: 0 4px 6px -1px rgba(219,39,119,0.2);}
        .btn:hover {background-color: #be185d; transform: translateY(-2px); box-shadow: 0 6px 15px -3px rgba(219,39,119,0.3);}
        .btn:active {transform: translateY(0); box-shadow: 0 2px 4px -1px rgba(219,39,119,0.2);}
        .btn-sm {padding: 0.5rem 1rem; font-size: 0.875rem;}
        .btn-outline {background-color: transparent; border: 1px solid #db2777; color: #db2777;}
        .btn-outline:hover {background-color: rgba(219,39,119,0.05); color: #be185d; border-color: #be185d;}
        .btn-secondary {background-color: #6b7280; color: white;}
        .btn-secondary:hover {background-color: #4b5563;}
        .btn-success {background-color: #10b981; color: white;}
        .btn-success:hover {background-color: #059669;}
        
        /* Elementos form */
        .form-grid {display: grid; gap: 1.5rem; max-width: 600px; margin: 0 auto;}
        .form-row {display: grid; grid-template-columns: 1fr;}
        .form-row.cols-2 {grid-template-columns: 1fr 1fr; gap: 1rem;}
        .form-group {display: flex; flex-direction: column; gap: 0.5rem;}
        .form-label {font-weight: 500; color: #374151;}
        .form-input {padding: 0.75rem 1rem; border: 1px solid #d1d5db; border-radius: 0.5rem; font-family: inherit; font-size: 1rem; transition: border-color 0.2s ease;}
        .form-input:focus {outline: none; border-color: #db2777; box-shadow: 0 0 0 2px rgba(219,39,119,0.1);}
        .form-select {padding: 0.75rem 1rem; border: 1px solid #d1d5db; border-radius: 0.5rem; font-family: inherit; font-size: 1rem; transition: border-color 0.2s ease; background-color: white;}
        .text-area {min-height: 100px; resize: vertical;}
        
        /* Perfil Elementos */
        .profile-header {display: flex; flex-direction: column; align-items: center; margin-bottom: 2rem;}
        .profile-avatar {width: 100px; height: 100px; border-radius: 50%; background-color: #f3f4f6; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; color: #9ca3af; margin-bottom: 1rem; position: relative; overflow: hidden;}
        .profile-avatar img {width: 100%; height: 100%; object-fit: cover;}
        .avatar-upload {position: absolute; inset: 0; background-color: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.2s ease; cursor: pointer;}
        .avatar-upload:hover {opacity: 1;}
        .avatar-upload svg {color: white;}
        .profile-name {font-size: 1.5rem; font-weight: 600; color: #111827; margin-bottom: 0.25rem;}
        .profile-details {display: flex; flex-direction: column; align-items: center; color: #6b7280; font-size: 0.875rem;}
        
        /* Modal */
        .modal-overlay {display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.5); z-index: 100; align-items: center; justify-content: center; padding: 1rem;}
        .modal-overlay.active {display: flex; animation: fadeIn 0.3s ease-out;}
        .modal {background-color: white; border-radius: 0.75rem; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.2);}
        .modal-header {display: flex; justify-content: space-between; align-items: center; padding: 1.5rem 1.5rem 1rem; border-bottom: 1px solid #f3f4f6;}
        .modal-title {font-size: 1.25rem; font-weight: 600; color: #111827;}
        .modal-close {background: none; border: none; color: #9ca3af; cursor: pointer; font-size: 1.25rem; line-height: 1; transition: color 0.2s ease;}
        .modal-close:hover {color: #111827;}
        .modal-body {padding: 1.5rem;}
        .modal-footer {padding: 1rem 1.5rem 1.5rem; border-top: 1px solid #f3f4f6; display: flex; justify-content: flex-end; gap: 0.75rem;}
        
        /* Rating */
        .rating {display: flex; gap: 0.25rem;}
        .rating-star {color: #d1d5db; cursor: pointer; transition: color 0.2s ease;}
        .rating-star.active, .rating-star:hover {color: #f59e0b;}
        
        /* Notificações */
        .toast-container {position: fixed; bottom: 1rem; right: 1rem; z-index: 1000; display: flex; flex-direction: column; gap: 0.5rem; max-width: 350px;}
        .toast {background-color: white; border-radius: 0.5rem; padding: 1rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06); display: flex; align-items: center; gap: 0.75rem; animation: slideIn 0.3s ease-out; transform: translateX(100%); border-left: 4px solid #10b981;}
        .toast-icon {color: #10b981; display: flex; align-items: center; justify-content: center;}
        .toast-content {flex: 1;}
        .toast-title {font-weight: 600; color: #111827; font-size: 0.9375rem; margin-bottom: 0.25rem;}
        .toast-message {color: #6b7280; font-size: 0.875rem;}
        
        /* Tab */
        .tabs {display: flex; border-bottom: 1px solid #e5e7eb; margin-bottom: 1.5rem;}
        .tab {padding: 0.75rem 1.25rem; color: #6b7280; font-weight: 500; cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.2s ease;}
        .tab:hover {color: #111827;}
        .tab.active {color: #db2777; border-color: #db2777;}
        .tab-content {display: none;}
        .tab-content.active {display: block;}

        /* Footer */
        .footer {background-color: #111827; color: white; padding: 1.5rem; text-align: center;}
        .copyright {font-size: 0.875rem; color: #9ca3af;}
        
        /* Animações */
        @keyframes fadeIn {from {opacity: 0; transform: translateY(20px);} to {opacity: 1; transform: translateY(0);}}
        @keyframes slideIn {from {transform: translateX(100%);} to {transform: translateX(0);}}
        
        /* Responsividade */
        @media (min-width: 640px) {.grid {grid-template-columns: repeat(2, 1fr);}}
        @media (min-width: 1024px) {.grid {grid-template-columns: repeat(3, 1fr);}}
        @media (max-width: 768px) {
            .menu-toggle {display: block;}
            .nav-links {position: fixed; top: 70px; left: 0; right: 0; background-color: rgba(255,255,255,0.95); flex-direction: column; padding: 1rem 0; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); transform: translateY(-100%); opacity: 0; pointer-events: none; transition: all 0.3s ease;}
            .nav-links.active {transform: translateY(0); opacity: 1; pointer-events: auto;}
            .nav-link {width: 100%; text-align: center; padding: 1rem 0;}
            .form-row.cols-2 {grid-template-columns: 1fr;}
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Barra Navegação -->
        <header class="navbar">
            <div class="nav-container">
                <div class="logo">FastHub</div>
                
                <button class="menu-toggle" id="menuToggle">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
                
                <nav class="nav-links" id="navLinks">
                    <a href="#" class="nav-link" data-page="home">Serviços Disponíveis</a>
                    <a href="#" class="nav-link" data-page="request">Solicitar Serviço</a>
                    <a href="#" class="nav-link" data-page="myrequests">Minhas Solicitações</a>
                    <a href="#" class="nav-link" data-page="profile">Meu Perfil</a>
                </nav>
            </div>
        </header>

        <!-- Main Conteúdo -->
        <main class="content">
            <!-- Home Page (Serviços Disponíveis) -->
            <section id="home" class="page active">
                <div class="header">
                    <h1 class="title">Serviços Disponíveis</h1>
                    <p class="subtitle">Profissionais qualificados disponíveis em sua região para atender às suas necessidades.</p>
                </div>
                
                <div class="action" style="text-align: center;">
                    <button class="btn" id="requestServiceBtn">
                        Solicitar um novo serviço
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                </div>
                
                <div class="grid" id="servicesGrid">
                    <!-- Serviços serão inseridos via JavaScript -->
                </div>
            </section>
            
            <!-- Soliicitação Serviço -->
            <section id="request" class="page">
                <div class="header">
                    <h1 class="title">Solicitar Serviço</h1>
                    <p class="subtitle">Descreva o serviço que você precisa e encontre profissionais qualificados para ajudá-lo.</p>
                </div>
                
                <form id="requestForm" class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Título do Serviço</label>
                        <input type="text" id="serviceTitle" class="form-input" placeholder="Ex: Instalação de ar-condicionado" required>
                    </div>
                    
                    <div class="form-row cols-2">
                        <div class="form-group">
                            <label class="form-label">Categoria</label>
                            <select id="serviceCategory" class="form-select" required>
                                <option value="">Selecione uma categoria</option>
                                <option value="eletrico">Elétrico</option>
                                <option value="hidraulico">Hidráulico</option>
                                <option value="ar-condicionado">Ar-Condicionado</option>
                                <option value="limpeza">Limpeza</option>
                                <option value="pintura">Pintura</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Urgência</label>
                            <select id="serviceUrgency" class="form-select" required>
                                <option value="">Selecione a urgência</option>
                                <option value="high">Urgente</option>
                                <option value="medium">Moderado</option>
                                <option value="low">Planejado</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Descrição do Serviço</label>
                        <textarea id="serviceDescription" class="form-input text-area" placeholder="Descreva detalhadamente o que você precisa..." required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Localização</label>
                        <input type="text" id="serviceLocation" class="form-input" placeholder="Ex: Rua, Bairro, Cidade" required>
                    </div>
                    
                    <button type="submit" class="btn">
                        Solicitar Serviço
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                    </button>
                </form>
            </section>
            
            <!-- MInhas Solicitações -->
            <section id="myrequests" class="page">
                <div class="header">
                    <h1 class="title">Minhas Solicitações</h1>
                    <p class="subtitle">Acompanhe o status de suas solicitações e propostas recebidas.</p>
                </div>
                
                <div class="tabs">
                    <div class="tab active" data-tab="active">Solicitações Ativas</div>
                    <div class="tab" data-tab="completed">Serviços Concluídos</div>
                </div>
                
                <div id="activeTab" class="tab-content active">
                    <!-- Solicitações ativas serão inseridas via JavaScript -->
                </div>
                
                <div id="completedTab" class="tab-content">
                    <!-- Serviços concluídos serão inseridos via JavaScript -->
                </div>
            </section>
            
            <!-- Perfil -->
            <section id="profile" class="page">
                <div class="header">
                    <h1 class="title">Meu Perfil</h1>
                    <p class="subtitle">Mantenha suas informações atualizadas para uma melhor experiência.</p>
                </div>
                
                <div class="profile-header">
                    <div class="profile-avatar">
                        <div id="profileImage">R</div>
                        <label class="avatar-upload">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                                <circle cx="12" cy="13" r="4"></circle>
                            </svg>
                            <input type="file" id="avatarInput" style="display: none;" accept="image/*">
                        </label>
                    </div>
                    <h3 class="profile-name" id="profileNameDisplay">Rafael Souza</h3>
                    <div class="profile-details">
                        <span id="profileEmailDisplay">rafael.souza@email.com</span>
                        <span id="profilePhoneDisplay">(11) 99876-5432</span>
                    </div>
                </div>
                
                <form id="profileForm" class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Nome Completo</label>
                        <input type="text" id="profileName" class="form-input" value="Rafael Souza">
                    </div>
                    
                    <div class="form-row cols-2">
                        <div class="form-group">
                            <label class="form-label">E-mail</label>
                            <input type="email" id="profileEmail" class="form-input" value="rafael.souza@email.com">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Telefone</label>
                            <input type="tel" id="profilePhone" class="form-input" value="(11) 99876-5432">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Endereço</label>
                        <input type="text" id="profileAddress" class="form-input" value="Rua das Flores, 123 - São Paulo, SP">
                    </div>
                    
                    <button type="submit" class="btn">
                        Salvar Alterações
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                            <polyline points="17 21 17 13 7 13 7 21"></polyline>
                            <polyline points="7 3 7 8 15 8"></polyline>
                        </svg>
                    </button>
                </form>
            </section>
        </main>

        <!-- Contato do Prestador -->
        <div class="modal-overlay" id="contactModal">
            <div class="modal">
                <div class="modal-header">
                    <h3 class="modal-title">Contato do Prestador</h3>
                    <button class="modal-close" id="contactModalClose">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Nome do Prestador</label>
                        <p id="providerName" class="form-input" style="background-color: #f9fafb;"></p>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Telefone para Contato</label>
                        <p id="providerPhone" class="form-input" style="background-color: #f9fafb;"></p>
                    </div>
                    <p class="text-sm text-gray-500 mt-4">Agora você pode entrar em contato diretamente com o prestador para combinar os detalhes do serviço.</p>
                </div>
                <div class="modal-footer">
                    <button class="btn" id="copyPhoneBtn">
                        Copiar Telefone
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Avaliação -->
        <div class="modal-overlay" id="ratingModal">
            <div class="modal">
                <div class="modal-header">
                    <h3 class="modal-title">Avaliar Serviço</h3>
                    <button class="modal-close" id="ratingModalClose">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Sua avaliação</label>
                        <div class="rating" id="ratingStars">
                            <span class="rating-star" data-rating="1">★</span>
                            <span class="rating-star" data-rating="2">★</span>
                            <span class="rating-star" data-rating="3">★</span>
                            <span class="rating-star" data-rating="4">★</span>
                            <span class="rating-star" data-rating="5">★</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Comentário (opcional)</label>
                        <textarea id="ratingComment" class="form-input text-area" placeholder="Compartilhe sua experiência com este serviço..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn" id="submitRatingBtn">
                        Enviar Avaliação
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Toast Container -->
        <div class="toast-container" id="toastContainer">
            <!-- Toasts will be added here dynamically -->
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p class="copyright">&copy; 2024 FastHub. Todos os direitos reservados.</p>
        </footer>
    </div>
    
    <script>

        // Variáveis globais
let selectedServiceId = null;
let selectedProposalId = null;
let currentRating = 0;

// Elementos DOM
const toastContainer = document.getElementById('toastContainer');
const contactModal = document.getElementById('contactModal');
const ratingModal = document.getElementById('ratingModal');
const providerName = document.getElementById('providerName');
const providerPhone = document.getElementById('providerPhone');
const ratingStars = document.getElementById('ratingStars');

// Função para buscar dados do usuário pelo email
async function fetchUserData() {
    try {
        const userEmail = localStorage.getItem('username');
        if (!userEmail) {
            console.error('Nenhum usuário logado encontrado');
            return null;
        }

        const response = await fetch(`http://168.231.92.116:8081/usuario?email=${userEmail}`);
        if (!response.ok) throw new Error('Erro ao buscar usuário');
        
        const userData = await response.json();
        return userData;
    } catch (error) {
        console.error('Erro ao buscar dados do usuário:', error);
        return null;
    }
}

// Função para carregar dados do perfil
async function loadProfileData() {
    const userData = await fetchUserData();
    if (!userData) return;

    try {
        const response = await fetch(`http://168.231.92.116:8081/cliente/meuperfil/${userData.id}`);
        if (!response.ok) throw new Error('Erro ao buscar perfil');
        
        const profileData = await response.json();
        
        // Preencher o formulário com os dados
        document.getElementById('profileName').value = profileData.nome || '';
        document.getElementById('profileEmail').value = profileData.email || '';
        document.getElementById('profilePhone').value = profileData.telefone || '';
        
        // Atualizar as informações exibidas
        document.getElementById('profileNameDisplay').textContent = profileData.nome || '';
        document.getElementById('profileEmailDisplay').textContent = profileData.email || '';
        document.getElementById('profilePhoneDisplay').textContent = profileData.telefone || '';
        document.getElementById('profileImage').textContent = (profileData.nome || '').charAt(0);
        
    } catch (error) {
        console.error('Erro ao carregar perfil:', error);
        showToast('Erro', 'Não foi possível carregar os dados do perfil', 'error');
    }
}

// Função para gerar os cards de serviços disponíveis
function generateServiceCards() {
    const grid = document.getElementById('servicesGrid');
    grid.innerHTML = '';
    
    availableServices.forEach((service, index) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.style.animationDelay = `${index * 0.1}s`;
        
        card.innerHTML = `
            <div class="service-category category-${service.category}">${service.categoryName}</div>
            <div class="card-content">
                <h3 class="card-title">${service.name}</h3>
                <div class="card-meta">
                    <div>
                        <span style="color: #f59e0b;">★</span> ${service.rating.toFixed(1)}
                    </div>
                </div>
            </div>
        `;
        
        grid.appendChild(card);
    });
}

// Função para gerar as solicitações ativas
function generateActiveRequests() {
    const activeTab = document.getElementById('activeTab');
    activeTab.innerHTML = '';
    
    const activeRequests = userRequests.filter(request => request.status === 'active');
    
    if (activeRequests.length === 0) {
        activeTab.innerHTML = '<p class="text-center text-gray-500 my-8">Você não tem solicitações ativas no momento.</p>';
        return;
    }
    
    activeRequests.forEach(request => {
        const requestCard = document.createElement('div');
        requestCard.className = 'card mb-6';
        
        let proposalsHtml = '';
        if (request.proposals.length > 0) {
            proposalsHtml = `
                <div class="mt-4 pt-4 border-t border-gray-100">
                    <h4 class="text-lg font-medium mb-3">Propostas Recebidas (${request.proposals.length})</h4>
                    <div class="space-y-4">
                        ${request.proposals.map(proposal => `
                            <div class="proposal-card">
                                <div class="proposal-provider">
                                    <div class="provider-icon">${proposal.providerName.charAt(0)}</div>
                                    <span>${proposal.providerName}</span>
                                </div>
                                <div class="proposal-price">R$ ${proposal.price}</div>
                                <p class="proposal-message">${proposal.message}</p>
                                <div class="proposal-actions">
                                    <button class="btn btn-sm btn-success accept-proposal-btn" data-request-id="${request.id}" data-proposal-id="${proposal.id}">
                                        Aceitar Proposta
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        } else {
            proposalsHtml = '<p class="mt-4 pt-4 border-t border-gray-100 text-gray-500">Ainda não há propostas para esta solicitação.</p>';
        }
        
        requestCard.innerHTML = `
            <div class="service-category category-${request.category}">${request.categoryName}</div>
            <div class="card-content">
                <h3 class="card-title">${request.title}</h3>
                <p class="card-description">${request.description}</p>
                <div class="card-meta border-t border-gray-100">
                    <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                        ${request.location}
                    </div>
                    <div class="urgency-${request.urgency}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="8" x2="12" y2="12"></line>
                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                        </svg>
                        ${request.urgencyLabel}
                    </div>
                </div>
                ${proposalsHtml}
            </div>
        `;
        
        activeTab.appendChild(requestCard);
    });
    
    // Adiciona event listeners para os botões de aceitar proposta
    document.querySelectorAll('.accept-proposal-btn').forEach(button => {
        button.addEventListener('click', function() {
            const requestId = parseInt(this.getAttribute('data-request-id'));
            const proposalId = parseInt(this.getAttribute('data-proposal-id'));
            acceptProposal(requestId, proposalId);
        });
    });
}

// Função para gerar os serviços concluídos
function generateCompletedRequests() {
    const completedTab = document.getElementById('completedTab');
    completedTab.innerHTML = '';
    
    const completedRequests = userRequests.filter(request => request.status === 'completed');
    
    if (completedRequests.length === 0) {
        completedTab.innerHTML = '<p class="text-center text-gray-500 my-8">Você não tem serviços concluídos ainda.</p>';
        return;
    }
    
    completedRequests.forEach(request => {
        const requestCard = document.createElement('div');
        requestCard.className = 'card mb-6';
        
        let ratingHtml = '';
        if (request.rating) {
            const stars = '★'.repeat(request.rating) + '☆'.repeat(5 - request.rating);
            ratingHtml = `
                <div class="mt-4 pt-4 border-t border-gray-100">
                    <h4 class="text-lg font-medium mb-2">Sua avaliação</h4>
                    <div class="flex justify-between items-center">
                        <div style="color: #f59e0b; font-size: 1.25rem;">${stars}</div>
                        <button class="btn btn-sm btn-outline view-contact-btn" data-request-id="${request.id}">
                            Ver Contato
                        </button>
                    </div>
                    ${request.comment ? `<p class="mt-2 text-gray-600">"${request.comment}"</p>` : ''}
                </div>
            `;
        } else {
            ratingHtml = `
                <div class="mt-4 pt-4 border-t border-gray-100">
                    <div class="flex justify-between items-center">
                        <button class="btn btn-sm rate-service-btn" data-request-id="${request.id}">
                            Avaliar Serviço
                        </button>
                        <button class="btn btn-sm btn-outline view-contact-btn" data-request-id="${request.id}">
                            Ver Contato
                        </button>
                    </div>
                </div>
            `;
        }
        
        requestCard.innerHTML = `
            <div class="service-category category-${request.category}">${request.categoryName}</div>
            <div class="card-content">
                <h3 class="card-title">${request.title}</h3>
                <p class="card-description">${request.description}</p>
                <div class="card-meta border-t border-gray-100">
                    <div>Concluído em: ${request.date}</div>
                    <div>Prestador: ${request.provider.name}</div>
                </div>
                ${ratingHtml}
            </div>
        `;
        
        completedTab.appendChild(requestCard);
    });
    
    // Adiciona event listeners para os botões
    document.querySelectorAll('.rate-service-btn').forEach(button => {
        button.addEventListener('click', function() {
            const requestId = parseInt(this.getAttribute('data-request-id'));
            openRatingModal(requestId);
        });
    });
    
    document.querySelectorAll('.view-contact-btn').forEach(button => {
        button.addEventListener('click', function() {
            const requestId = parseInt(this.getAttribute('data-request-id'));
            openContactModal(requestId);
        });
    });
}

// Função para aceitar uma proposta
function acceptProposal(requestId, proposalId) {
    const requestIndex = userRequests.findIndex(req => req.id === requestId);
    if (requestIndex === -1) return;
    
    const proposalIndex = userRequests[requestIndex].proposals.findIndex(prop => prop.id === proposalId);
    if (proposalIndex === -1) return;
    
    const proposal = userRequests[requestIndex].proposals[proposalIndex];
    
    // Atualiza o status da solicitação para concluído
    userRequests[requestIndex].status = 'completed';
    userRequests[requestIndex].provider = {
        id: proposal.providerId,
        name: proposal.providerName,
        phone: proposal.phone
    };
    
    // Remove as propostas já que uma foi aceita
    delete userRequests[requestIndex].proposals;
    
    showToast('Proposta aceita!', `Você aceitou a proposta de ${proposal.providerName}. Agora você pode entrar em contato diretamente.`);
    
    // Atualiza as listas
    generateActiveRequests();
    generateCompletedRequests();
    
    // Abre o modal de contato automaticamente
    openContactModal(requestId);
}

// Função para abrir o modal de contato
function openContactModal(requestId) {
    const request = userRequests.find(req => req.id === requestId);
    if (!request || !request.provider) return;
    
    providerName.textContent = request.provider.name;
    providerPhone.textContent = request.provider.phone;
    
    contactModal.classList.add('active');
}

// Função para abrir o modal de avaliação
function openRatingModal(requestId) {
    selectedServiceId = requestId;
    currentRating = 0;
    
    // Limpa as estrelas ativas
    document.querySelectorAll('.rating-star').forEach(star => {
        star.classList.remove('active');
    });
    
    document.getElementById('ratingComment').value = '';
    
    ratingModal.classList.add('active');
}

// Função para enviar avaliação
function submitRating() {
    if (currentRating === 0) {
        showToast('Erro', 'Por favor, selecione uma classificação.', 'error');
        return;
    }
    
    const requestIndex = userRequests.findIndex(req => req.id === selectedServiceId);
    if (requestIndex === -1) return;
    
    userRequests[requestIndex].rating = currentRating;
    userRequests[requestIndex].comment = document.getElementById('ratingComment').value;
    
    showToast('Avaliação enviada', 'Obrigado por avaliar o serviço!');
    
    ratingModal.classList.remove('active');
    generateCompletedRequests();
}

// Função para mostrar toast notification
function showToast(title, message, type = 'success') {
    const toast = document.createElement('div');
    toast.className = 'toast';
    
    if (type === 'error') {
        toast.style.borderColor = '#ef4444';
    }
    
    toast.innerHTML = `
        <div class="toast-icon" style="${type === 'error' ? 'color: #ef4444;' : ''}">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                ${type === 'success' ? 
                    '<polyline points="20 6 9 17 4 12"></polyline>' : 
                    '<line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>'}
            </svg>
        </div>
        <div class="toast-content">
            <div class="toast-title">${title}</div>
            <div class="toast-message">${message}</div>
        </div>
    `;
    
    toastContainer.appendChild(toast);
    
    // Adiciona a animação após um pequeno delay
    setTimeout(() => {
        toast.style.transform = 'translateX(0)';
    }, 10);
    
    // Remove o toast após 4 segundos
    setTimeout(() => {
        toast.style.transform = 'translateX(100%)';
        setTimeout(() => {
            toast.remove();
        }, 300);
    }, 4000);
}

// Função para lidar com o envio do formulário de solicitação
function handleRequestSubmit(e) {
    e.preventDefault();
    
    const title = document.getElementById('serviceTitle').value;
    const category = document.getElementById('serviceCategory').value;
    const categoryName = document.getElementById('serviceCategory').options[document.getElementById('serviceCategory').selectedIndex].text;
    const urgency = document.getElementById('serviceUrgency').value;
    const urgencyLabel = document.getElementById('serviceUrgency').options[document.getElementById('serviceUrgency').selectedIndex].text;
    const description = document.getElementById('serviceDescription').value;
    const location = document.getElementById('serviceLocation').value;
    
    // Cria a nova solicitação
    const newRequest = {
        id: Date.now(),
        title,
        category,
        categoryName,
        description,
        urgency,
        urgencyLabel,
        status: 'active',
        location,
        date: new Date().toLocaleDateString(),
        proposals: []
    };
    
    // Adiciona à lista
    userRequests.unshift(newRequest);
    
    // Limpa o formulário
    document.getElementById('requestForm').reset();
    
    showToast('Solicitação enviada', 'Sua solicitação foi enviada com sucesso! Em breve você receberá propostas.');
    
    // Navega para a página de solicitações
    navigateTo('myrequests');
    
    // Atualiza as listas
    generateActiveRequests();
}

// Função para lidar com o envio do formulário de perfil
function handleProfileSubmit(e) {
    e.preventDefault();
    
    const name = document.getElementById('profileName').value;
    const email = document.getElementById('profileEmail').value;
    const phone = document.getElementById('profilePhone').value;
    
    // Atualiza as informações exibidas
    document.getElementById('profileNameDisplay').textContent = name;
    document.getElementById('profileEmailDisplay').textContent = email;
    document.getElementById('profilePhoneDisplay').textContent = phone;
    document.getElementById('profileImage').textContent = name.charAt(0);
    
    showToast('Perfil atualizado', 'Suas informações foram atualizadas com sucesso!');
}

// Navegação entre páginas
function navigateTo(pageId) {
    document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
    });
    
    document.getElementById(pageId).classList.add('active');
    
    // Fecha o menu mobile se estiver aberto
    const navLinks = document.getElementById('navLinks');
    if (navLinks.classList.contains('active')) {
        navLinks.classList.remove('active');
    }
}

// Navegação entre tabs
function setupTabs() {
    document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', function() {
            const tabId = this.getAttribute('data-tab');
            
            // Desativa todas as tabs
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            // Ativa a tab selecionada
            this.classList.add('active');
            document.getElementById(`${tabId}Tab`).classList.add('active');
        });
    });
}

// Inicialização
document.addEventListener('DOMContentLoaded', function() {
    // Gera os cards e listas iniciais
    generateServiceCards();
    generateActiveRequests();
    generateCompletedRequests();
    
    // Setup de navegação e tabs
    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const page = this.getAttribute('data-page');
            navigateTo(page);
            
            // Carrega os dados do perfil se for a página de perfil
            if (page === 'profile') {
                loadProfileData();
            }
        });
    });
    
    setupTabs();
    
    // Event listeners para o botão de toggle do menu
    document.getElementById('menuToggle').addEventListener('click', function() {
        document.getElementById('navLinks').classList.toggle('active');
    });
    
    // Event listener para o botão de requisitar serviço
    document.getElementById('requestServiceBtn').addEventListener('click', function() {
        navigateTo('request');
    });
    
    // Event listeners para os modais
    document.getElementById('contactModalClose').addEventListener('click', function() {
        contactModal.classList.remove('active');
    });
    
    document.getElementById('ratingModalClose').addEventListener('click', function() {
        ratingModal.classList.remove('active');
    });
    
    // Event listener para copiar telefone
    document.getElementById('copyPhoneBtn').addEventListener('click', function() {
        const phone = document.getElementById('providerPhone').textContent;
        navigator.clipboard.writeText(phone).then(() => {
            showToast('Telefone copiado', 'O número de telefone foi copiado para a área de transferência.');
        });
    });
    
    // Event listeners para o sistema de classificação
    document.querySelectorAll('.rating-star').forEach(star => {
        star.addEventListener('click', function() {
            const rating = parseInt(this.getAttribute('data-rating'));
            currentRating = rating;
            
            // Limpa todas as estrelas
            document.querySelectorAll('.rating-star').forEach(s => {
                s.classList.remove('active');
            });
            
            // Ativa as estrelas até a classificação selecionada
            document.querySelectorAll(`.rating-star[data-rating]`).forEach(s => {
                if (parseInt(s.getAttribute('data-rating')) <= rating) {
                    s.classList.add('active');
                }
            });
        });
    });
    
    // Event listener para enviar classificação
    document.getElementById('submitRatingBtn').addEventListener('click', submitRating);
    
    // Event listeners para formulários
    document.getElementById('requestForm').addEventListener('submit', handleRequestSubmit);
    document.getElementById('profileForm').addEventListener('submit', handleProfileSubmit);
    
    // Event listener para o upload de imagem de perfil
    document.getElementById('avatarInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = document.createElement('img');
                img.src = event.target.result;
                const profileImage = document.getElementById('profileImage');
                profileImage.innerHTML = '';
                profileImage.appendChild(img);
            };
            reader.readAsDataURL(file);
        }
    });
    
    // Fecha modais ao clicar fora
    contactModal.addEventListener('click', function(e) {
        if (e.target === contactModal) contactModal.classList.remove('active');
    });
    
    ratingModal.addEventListener('click', function(e) {
        if (e.target === ratingModal) ratingModal.classList.remove('active');
    });
    
    // Carrega os dados do perfil se a página inicial for a de perfil
    if (document.getElementById('profile').classList.contains('active')) {
        loadProfileData();
    }
});    
</script>
</body>
</html>

